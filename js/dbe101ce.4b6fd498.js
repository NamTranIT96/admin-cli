(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dbe101ce"],{7712:function(e,t,i){"use strict";var a=i("f2ac"),o=i.n(a);o.a},d1a0:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"schedule-manage-wrapper q-pa-md"},[i("div",{staticClass:"title-and-controller"},[i("div",{staticClass:"text-title"},[e._v("\n      Operations\n      "),i("q-icon",{staticClass:"q-mr-xs q-ml-xs",attrs:{dense:"",name:"keyboard_arrow_right",size:"sm"}}),e._v("\n      Schedule management\n    ")],1)]),i("div",{staticClass:"flex items-center"},[e.is_admin||e.is_mod||e.is_operator||e.is_operator_can_group_bk?i("div",{staticClass:"filter-wrapper q-mt-md q-mr-md flex items-center"},[i("div",{staticClass:"q-mr-md"},[e._v("Select tour guide:")]),i("div",[i("el-select",{attrs:{size:"mini",placeholder:"Choosed"},on:{change:function(t){return e.chooseTourGuideViewSchedule()}},model:{value:e.select_tour_guide_view_schedule,callback:function(t){e.select_tour_guide_view_schedule=t},expression:"select_tour_guide_view_schedule"}},e._l(e.options_list_tour_guide,(function(e){return i("el-option",{key:e.userId,attrs:{label:e.user_full_name,value:e.userId}})})),1)],1)]):e._e(),i("div",{staticClass:"filter-wrapper q-mt-md flex items-center",staticStyle:{width:"250px"}},[i("div",{staticStyle:{width:"50px"}},[e._v("Filter:")]),i("div",{staticStyle:{width:"200px"}},[i("picker-filter",{attrs:{id:"picker-custom",noClearButton:!0,formatted:"l",autoClose:!0,noShortcuts:!0,noHeader:!0,"no-label":!0,range:!0,format:"DD/MM/YYYY",color:"#027BE3"},model:{value:e.filter_date,callback:function(t){e.filter_date=t},expression:"filter_date"}})],1)])]),(e.is_admin||e.is_operator||e.is_operator_can_group_bk)&&null!=e.select_tour_guide_view_schedule||!e.is_admin&&!e.is_operator&&!e.is_operator_can_group_bk?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_load,expression:"loading_load"}],staticClass:"table-wrapper q-mt-lg"},[i("q-table",{staticClass:"custom-sticky",attrs:{data:e.data,separator:"cell",columns:e.columns,"row-key":"name"},scopedSlots:e._u([{key:"body-cell",fn:function(t){return[i("q-td",{staticClass:"cell-data-wrapper",attrs:{props:t}},[i("div",{staticClass:"content-item",on:{click:function(i){return e.changeStatusSchedule(t)}}},[1==t.value?i("div",[i("q-icon",{attrs:{name:"clear",color:"black",size:"md"}})],1):0==t.value?i("div"):i("div",[e._v(e._s(t.value))])])])]}}],null,!1,3780246671)})],1):e._e()])},o=[],n=(i("8e6e"),i("8a81"),i("6b54"),i("ac6a"),i("cadf"),i("06db"),i("456d"),i("8993")),r=i.n(n),s=(i("28a5"),i("7f7f"),i("c47a")),l=i.n(s),c=i("2f62"),u=i("d5b7"),d=i("e30a"),g=i.n(d);i("b40d");function _(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?_(i,!0).forEach((function(t){l()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var p={name:"Schedule-manage",filters:{},computed:f({},Object(c["b"])({current_user_logged_info:"login/getUserLoggedInfo",current_branch_id:"login/getCurrentBranchId",info_user_jwt:"login/getInfoUserJWT",role_perm:"login/getInfoPerm",is_admin:"login/getRoleAdmin",is_mod:"login/getRoleMod",is_sales:"login/getRoleSales",is_operator:"login/getRoleOperation",is_operator_can_group_bk:"login/getRoleOperationCanGroupBK",is_staff:"login/getRoleStaff",is_tour_guide:"login/getRoleTourGuide"})),watch:{current_branch_id:function(e){!isNaN(e)&&parseInt(e)>0&&this.initDateFromTo()},filter_date:function(e){e.end&&this.changeFilterDate()}},data:function(){return{loading_load:!1,filter_date:[],columns:[{name:"name",required:!0,label:"Period",align:"left",field:function(e){return e.name},format:function(e){return"".concat(e)}}],data:[{name:"Morning"},{name:"Afternoon"},{name:"Evening"}],list_schedule:[],select_tour_guide_view_schedule:null,options_list_tour_guide:[]}},methods:{getPermRole:function(e){return-1!=this.role_perm.indexOf(e)},getDateFromDateFilter:function(e){if(e){var t=e.split("/"),i=t[0],a=t[1],o=t[2],n=new Date(parseInt(o),parseInt(a)-1,parseInt(i),0,0,0);return n}return null},chooseTourGuideViewSchedule:function(){this.getListSchedule()},changeFilterDate:function(){this.getListSchedule()},getDateFromDateFormat:function(e){var t=e.split("_"),i=(e=parseInt(t[0]),parseInt(t[1])-1),a=parseInt(t[2]);e=new Date(a,i,e,12,0,0);return e},changeStatusSchedule:function(e){console.log(e);var t=this,i=localStorage.getItem("user_token_fisheye_client"),a=this.current_branch_id,o=this.info_user_jwt.nameid;null!=t.select_tour_guide_view_schedule&&(t.is_admin||t.is_mod||t.is_operator||t.is_operator_can_group_bk)&&(o=t.select_tour_guide_view_schedule);var n=e.col.name,s=e.row.name,l=e.row[n],c=t.getDateFromDateFormat(n);if(-1!=a){var u={date:c.toISOString(),userId:o,branchId:a};"Morning"==s&&(u.isBusyMorning=!l),"Afternoon"==s&&(u.isBusyAfternoon=!l),"Evening"==s&&(u.isBusyEvening=!l),t.loading_load=!0,t.$axios.post("/api/Schedules/Update",JSON.stringify(u),{headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"}}).then((function(e){t.loading_load=!1,t.$q.notify({color:"secondary",position:"top-right",icon:"tag_faces",message:"Change status successfully"}),t.getListSchedule()})).catch((function(e){if(t.loading_load=!1,e.response.data){if("string"==typeof e.response.data)t.$q.notify({color:"red-5",textColor:"white",position:"top-right",icon:"warning",message:e.response.data});else if("object"==r()(e.response.data)){var i=Object.keys(e.response.data);i.length>0&&t.$q.notify({color:"red-5",textColor:"white",position:"top-right",icon:"warning",message:e.response.data[i[0]]})}}else t.$q.notify({color:"red-5",textColor:"white",position:"top-right",icon:"warning",message:"Have error"})}))}},getListSchedule:function(){var e=this,t=localStorage.getItem("user_token_fisheye_client"),i=this.current_branch_id,a=this.info_user_jwt.nameid;if(null!=e.select_tour_guide_view_schedule&&(e.is_admin||e.is_mod||e.is_operator||e.is_operator_can_group_bk)&&(a=e.select_tour_guide_view_schedule),e.loading_load=!0,-1!=i&&e.filter_date.start){var o="/api/Schedules/GetList?BranchId="+i+"&UserId="+a,n=e.getDateFromDateFilter(e.filter_date.start);n.setHours(7),n&&(o+="&FromDate="+n.toISOString().split("T")[0]);var r=e.getDateFromDateFilter(e.filter_date.end);r&&(r.setHours(30),o+="&ToDate="+r.toISOString().split("T")[0]),e.$axios.get(o,{headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"}}).then((function(t){e.loading_load=!1,e.list_schedule=t.data.schedules,e.initTable()})).catch((function(t){e.loading_load=!1,t.response.data?e.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:t.response.data}):e.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:"Have Error"})}))}},getFormattedDate:function(e){var t=e.getDate(),i=e.getMonth()+1,a=e.getFullYear();return t<10&&(t="0"+t),i<10&&(i="0"+i),t+"_"+i+"_"+a},getDateHeader:function(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=new Date(e),o=t[a.getDay()],n=i[a.getMonth()],r=a.getDate().toString(),s=a.getFullYear().toString();return o+", "+r+" "+n+" "+s},initTable:function(){var e=this;e.columns=[{name:"name",required:!0,label:"Period",align:"left",field:function(e){return e.name},format:function(e){return"".concat(e)}}];var t=e.getDateFromDateFilter(e.filter_date.start);t.setHours(12),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);var i=e.getDateFromDateFilter(e.filter_date.end);while(t<i){var a={name:e.getFormattedDate(t),align:"left",label:e.getDateHeader(t),field:e.getFormattedDate(t)};e.columns.push(a),e.data[0][a.field]=!1,e.data[1][a.field]=!1,e.data[2][a.field]=!1,e.getDataByDate(t,a.field),t.setDate(t.getDate()+1)}e.initData()},getDataByDate:function(e,t){var i=this,a=e.toISOString().slice(0,19);i.list_schedule.length>0&&i.list_schedule.forEach((function(e){e.date==a&&(i.data[0][t]=e.isBusyMorning,i.data[1][t]=e.isBusyAfternoon,i.data[2][t]=e.isBusyEvening)})),i.$forceUpdate()},initData:function(){},getDateFrom:function(){var e=new Date;e.setDate(e.getDate()+1);var t=e.getDate().toString(),i=(e.getMonth()+1).toString(),a=e.getFullYear().toString();return t+"/"+i+"/"+a},getDateTo:function(){var e=new Date;e.setMonth(e.getMonth()+1);var t=e.getDate().toString(),i=(e.getMonth()+1).toString(),a=e.getFullYear().toString();return t+"/"+i+"/"+a},initDateFromTo:function(){var e=this,t={start:this.getDateFrom(),end:this.getDateTo()};e.$set(e,"filter_date",t),e.$forceUpdate(),e.getListSchedule()},getListTourGuide:function(){var e=this,t=localStorage.getItem("branch_id_fisheye_client"),i=localStorage.getItem("user_token_fisheye_client");this.$axios.get("/api/StaffManagement/GetStaffList?branchId="+t+"&GetUserTourGuide=true",{headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"}}).then((function(t){t.data.staffs.forEach((function(e){e.user_full_name=e.user.fullName})),e.options_list_tour_guide=t.data.staffs})).catch((function(t){Object(u["a"])(t.response,e)}))}},components:{"picker-filter":g.a},mounted:function(){var e=this.$route.query.is_view_tour_guide;if(e){var t=this.$route.query.tour_guide_id;this.select_tour_guide_view_schedule=parseInt(t)}this.initDateFromTo(),this.getListTourGuide()}},h=p,m=(i("7712"),i("2877")),v=i("fe09"),b=Object(m["a"])(h,a,o,!1,null,null,null);t["default"]=b.exports;b.options.components=Object.assign({QIcon:v["n"],QTable:v["I"],QTd:v["K"]},b.options.components||{})},d5b7:function(e,t,i){"use strict";i("ac6a"),i("cadf"),i("06db"),i("456d");var a=i("8993"),o=i.n(a);function n(e,t){if(403==e.status);else if(e.data){if("string"==typeof e.data)t.$q.notify({color:"red-5",textColor:"white",position:"top-right",icon:"warning",message:e.data});else if("object"==o()(e.data)){var i=Object.keys(e.data);i.length>0&&t.$q.notify({color:"red-5",textColor:"white",position:"top-right",icon:"warning",message:e.data[i[0]]})}}else t.$q.notify({color:"red-5",textColor:"white",position:"top-right",icon:"warning",message:"Have error"})}t["a"]=n},f2ac:function(e,t,i){}}]);