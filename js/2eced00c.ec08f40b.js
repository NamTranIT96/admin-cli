(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2eced00c"],{"06a4":function(t,i,e){},2574:function(t,i,e){"use strict";e.r(i);var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"availability-wrapper q-pa-md"},[e("div",{staticClass:"title-wrapper"},[e("div",{staticClass:"main-title q-mb-md"},[t._v("\n        Sales\n        "),e("q-icon",{staticClass:"q-mr-xs q-ml-xs",attrs:{dense:"",name:"keyboard_arrow_right",size:"sm"}}),t._v("\n        Product availability\n      ")],1),e("div")]),e("div",{staticClass:"filter-wrapper"},[e("div",{staticClass:"flex items-center"},[e("div",{staticClass:"flex items-center q-mt-sm"},[e("div",{staticClass:"q-mr-md"},[t._v("From date:")]),e("div",[e("el-date-picker",{staticClass:"input-filter-date",attrs:{type:"date",placeholder:"Pick from day",size:"mini","default-time":["00:00:00"],format:"dd-MM-yyyy",clearable:!1},on:{change:function(i){return t.changeFilterFromDate()}},model:{value:t.from_date_filter,callback:function(i){t.from_date_filter=i},expression:"from_date_filter"}})],1)]),e("div",{staticClass:"flex items-center q-mt-sm"},[e("div",{staticClass:"q-ml-md q-mr-md"},[t._v("To date:")]),e("div",[e("el-date-picker",{staticClass:"input-filter-date",attrs:{disabled:null==t.from_date_filter||""==t.from_date_filter,type:"date",placeholder:"Pick to day",size:"mini","picker-options":t.pickerOptions,format:"dd-MM-yyyy"},on:{change:function(i){return t.initInfo()}},model:{value:t.to_date_filter,callback:function(i){t.to_date_filter=i},expression:"to_date_filter"}})],1)])]),e("div",{staticClass:"flex items-center q-mt-md"},[e("div",{staticClass:"q-mr-md"},[t._v("Choose Product:")]),e("div",[e("el-select",{staticClass:"choose-product-filter",attrs:{multiple:"",size:"mini",placeholder:"Select product","popper-class":"popper-choose-product-available"},on:{change:function(i){return t.getInfoDetailListProduct()}},model:{value:t.product_selected,callback:function(i){t.product_selected=i},expression:"product_selected"}},t._l(t.list_product,(function(t){return e("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),1)],1)])]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading_init_data,expression:"loading_init_data"}],staticClass:"list-avalability-wrapper q-mt-lg",staticStyle:{"min-height":"400px"}},t._l(t.list_availability_bind,(function(i,a){return e("div",{key:a,staticClass:"item-group-avai-by-date"},[e("div",{staticClass:"date-avai q-pa-md",staticStyle:{"background-color":"#f2f2f2","font-size":"18px","font-weight":"bold",color:"black"}},[t._v(t._s(t._f("formatDateSystem2")(i.date))+"\n        ")]),i.list_availability.length>0?e("div",{staticClass:"list-item-avai"},t._l(i.list_availability,(function(a,o){return e("div",{key:o,staticClass:"item-avai"},[e("div",{staticClass:"q-pa-md",staticStyle:{position:"relative"}},[e("div",{staticClass:"time-apply",staticStyle:{"font-size":"16px",color:"#4d4d4d","font-weight":"500"}},[t._v(t._s(a.time_apply)+"\n              ")]),a.info_avai?e("div",{staticClass:"status-label",staticStyle:{position:"absolute",top:"10px",right:"10px"}},[a.info_avai.isBlocked?e("q-chip",{attrs:{color:"red","text-color":"white"}},[t._v("BLOCKED\n                ")]):0==a.info_avai.availableSpots?e("q-chip",{attrs:{color:"red","text-color":"white"}},[t._v("SOLD OUT\n                ")]):e("q-chip",{attrs:{color:"teal","text-color":"white"}},[t._v("AVAILABLE")])],1):t._e(),e("div",{staticClass:"name-product q-mt-sm",staticStyle:{"font-size":"17px",color:"#4d4d4d"}},[t._v(t._s(a.product_title)+"\n              ")]),e("div",{staticClass:"name-option-price q-mt-sm",staticStyle:{"font-size":"17px",color:"#4d4d4d"}},[t._v(t._s(a.price_option_title)+"\n              ")]),a.info_avai?e("div",{staticClass:"block-control q-mt-sm"},[e("span",{staticClass:"q-mr-md",staticStyle:{"font-size":"17px",color:"#4d4d4d"}},[t._v("Blocked")]),e("el-switch",{attrs:{size:"mini","active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(e){return t.changeSwitchBlock(a,i.date)}},model:{value:a.info_avai.isBlocked,callback:function(i){t.$set(a.info_avai,"isBlocked",i)},expression:"item_avai.info_avai.isBlocked"}})],1):t._e(),a.info_avai?e("div",{staticClass:"q-mt-sm",staticStyle:{"font-size":"17px",color:"#4d4d4d"}},[t._v("Participants "+t._s(a.info_avai.bookedSpots)+" / "+t._s(a.info_avai.maxSpots)+" (\n                "+t._s(a.info_avai.availableSpots)+" spots left)\n              ")]):t._e()]),e("q-separator",{staticClass:"q-mt-md q-mb-md"})],1)})),0):e("div",{staticClass:"q-pt-md q-mb-md"},[t._v("No availablity")])])})),0)]),e("header-mobile",{attrs:{name_header_mobile:"Product availability"}})],1)},o=[],n=(e("8e6e"),e("8a81"),e("ac6a"),e("cadf"),e("06db"),e("456d"),e("7f7f"),e("28a5"),e("967e")),r=e.n(n),s=(e("96cf"),e("fa84")),l=e.n(s),c=e("c47a"),d=e.n(c),_=e("2f62"),p=e("7dae");function f(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);i&&(a=a.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,a)}return e}function u(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?f(e,!0).forEach((function(i){d()(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f(e).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}var v={name:"availability-page",filters:{},computed:u({},Object(_["b"])({current_user_logged_info:"login/getUserLoggedInfo",current_branch_id:"login/getCurrentBranchId"}),{pickerOptions:function(){var t=this;return{disabledDate:function(i){return i.getTime()<t.from_date_filter}}}}),watch:{current_branch_id:function(t){!isNaN(t)&&parseInt(t)>0&&this.getListProduct()}},data:function(){return{from_date_filter:null,to_date_filter:null,product_selected:[-1],list_product:[],list_product_to_get_availability:[],list_availability_bind:[],list_availability_bind_temp:[],list_date_current:[],list_info_avaibility:[],loading_init_data:!1}},methods:{changeSwitchBlock:function(t,i){var e=this,a=localStorage.getItem("user_token_fisheye_client"),o=this.current_branch_id,n={branchId:o,priceId:t.price_id,travelDate:i,timeApplied:t.time_apply};this.$axios.post("/api/Availabilities/BlockPrice",JSON.stringify(n),{headers:{Authorization:"Bearer "+a,"Content-Type":"application/json"}}).then((function(t){e.$q.notify({color:"secondary",position:"top-right",icon:"tag_faces",message:"Block successfully!"})})).catch((function(t){e.loading_init_data=!1,t.response.data?e.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:t.response.data}):e.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:"Have Error"})}))},changeFilterFromDate:function(){var t=this;t.to_date_filter=null,t.initInfo()},initInfo:function(){var t=this;t.loading_init_data=!0,t.list_availability_bind_temp=[],t.list_availability_bind=[],setTimeout((function(){t.list_date_current=t.getListDateToGetAvailability(),t.list_info_avaibility=t.getListAvaibilityOfProduct(),t.list_date_current.forEach((function(i){i.list_availability=[],t.list_info_avaibility.forEach((function(t){t.info_avai={};var e=new Date(i.date),a=new Date(t.start_time),o=!1;if(""==t.end_time||null==t.end_time)a<=e&&(o=!0);else{var n=new Date(t.end_time);a<=e&&n>=e&&(o=!0)}o&&-1!=t.day_apply.indexOf(i.day_of_week)&&i.list_availability.push(t)}));var e=JSON.parse(JSON.stringify(i));t.list_availability_bind_temp.push(e)})),t.getInfoCheckAvailabilityOfAllAvai()}),500)},checkAvaiAPI:function(){var t=l()(r.a.mark((function t(i,e,a,o){var n,s,l;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this,s=localStorage.getItem("user_token_fisheye_client"),t.next=4,n.$axios.get("/api/Availabilities/CheckAvailability?BranchId="+i+"&PriceId="+e+"&TravelDate="+a+"&TimeApplied="+o,{headers:{Authorization:"Bearer "+s,"Content-Type":"application/json"}});case 4:return l=t.sent,t.abrupt("return",l);case 6:case"end":return t.stop()}}),t,this)})));function i(i,e,a,o){return t.apply(this,arguments)}return i}(),getInfoCheckAvailabilityOfAllAvai:function(){var t=this,i=(localStorage.getItem("user_token_fisheye_client"),this.current_branch_id);t.list_availability_bind_temp.forEach((function(e,a){e.list_availability.length>0?e.list_availability.forEach((function(o,n){t.checkAvaiAPI(i,o.price_id,e.date.split("T")[0],o.time_apply).then((function(i){o.info_avai=JSON.parse(JSON.stringify(i.data)),t.$forceUpdate(),a==t.list_availability_bind_temp.length-1&&n==e.list_availability.length-1&&setTimeout((function(){t.initFinal(),t.loading_init_data=!1}),2e3)})).catch((function(i){t.loading_init_data=!1,i.response.data?t.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:i.response.data}):t.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:"Have Error"})}))})):a==t.list_availability_bind_temp.length-1&&setTimeout((function(){t.initFinal(),t.loading_init_data=!1}),2e3)}))},initFinal:function(){var t=this;t.list_availability_bind=JSON.parse(JSON.stringify(t.list_availability_bind_temp))},getListAvaibilityOfProduct:function(){var t=this,i=[];return t.list_product_to_get_availability.forEach((function(t){t.priceOptions.forEach((function(e){e.prices.forEach((function(a){a.timeApply.forEach((function(o){var n={time_apply:o,start_time:a.startTime,end_time:a.endTime,day_apply:a.daysApply,product_id:t.id,price_id:a.id,product_title:t.title,price_option_title:e.name};i.push(n)}))}))}))})),i},getInfoProductById:function(t,i){var e=this,a=localStorage.getItem("user_token_fisheye_client");this.$axios.get("/api/Products/GetProductDetail/"+t,{headers:{Authorization:"Bearer "+a,"Content-Type":"application/json"}}).then((function(t){e.list_product_to_get_availability.push(t.data),i&&(e.loading_init_data=!1,e.initInfo())})).catch((function(t){e.loading_init_data=!1,t.response.data?e.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:t.response.data}):e.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:"Have Error"})}))},getInfoDetailListProduct:function(){var t=this;if(t.list_product_to_get_availability=[],t.loading_init_data=!0,-1!=this.product_selected.indexOf(-1)){var i=t.list_product.map((function(t){return t.id}));i.forEach((function(e,a){-1!=e&&(a!=i.length-1?t.getInfoProductById(e,!1):t.getInfoProductById(e,!0))}))}else{i=t.product_selected;i.forEach((function(e,a){-1!=e&&(a!=i.length-1?t.getInfoProductById(e,!1):t.getInfoProductById(e,!0))}))}},getDateOfWeek:function(t){var i=t.getDay(),e="";switch(i){case 0:e="Sun";break;case 1:e="Mon";break;case 2:e="Tue";break;case 3:e="Wed";break;case 4:e="Thu";break;case 5:e="Fri";break;case 6:e="Sat";break}return e},getListDateToGetAvailability:function(){var t=this,i=[],e=new Date(t.from_date_filter);if(e.setHours(7),null==t.to_date_filter||""==t.to_date_filter){var a={date:e.toISOString(),day_of_week:t.getDateOfWeek(e)};i.push(a);for(var o=0;o<10;o++){e.setDate(e.getDate()+1);var n={date:e.toISOString(),day_of_week:t.getDateOfWeek(e)};i.push(n)}}else{var r=new Date(t.to_date_filter),s={date:e.toISOString(),day_of_week:t.getDateOfWeek(e)};i.push(s);for(o=0;o<1e14;o++){if(e.setDate(e.getDate()+1),!(e<=r))break;var l={date:e.toISOString(),day_of_week:t.getDateOfWeek(e)};i.push(l)}}return i},getListProduct:function(){var t=this,i=localStorage.getItem("user_token_fisheye_client");-1!=this.current_branch_id&&(t.loading_init_data=!0,this.$axios.get("/api/Products/GetProductList?BranchId="+t.current_branch_id+"&Status=1&PageSize=1000",{headers:{Authorization:"Bearer "+i,"Content-Type":"application/json"}}).then((function(i){i.data.products.unshift({id:-1,title:"Select all"}),t.list_product=i.data.products,t.getInfoDetailListProduct()})).catch((function(i){t.loading_init_data=!1,i.response.data?t.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:i.response.data}):t.$q.notify({color:"negative",icon:"report_problem",position:"top-right",message:"Have Error"})})))}},components:{"header-mobile":p["a"]},mounted:function(){var t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),this.from_date_filter=t,this.getListProduct()}},m=v,h=(e("cfad"),e("2877")),g=e("fe09"),b=Object(h["a"])(m,a,o,!1,null,null,null);i["default"]=b.exports;b.options.components=Object.assign({QIcon:g["n"],QChip:g["i"],QSeparator:g["C"]},b.options.components||{})},"7dae":function(t,i,e){"use strict";var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"w-100 header-mobile-wrapper"},[e("div",{staticClass:"h-100-per"},[e("div",{staticClass:"h-100-per"},[e("div",{staticClass:"text-header flex items-center"},[e("div",{staticClass:"q-pl-md name-product"},[t._v(t._s(t.name_header_mobile))])])])])])},o=[],n={name:"HeaderMobileCreateProduct",props:{name_header_mobile:{type:String,default:""}},data:function(){return{}},methods:{}},r=n,s=e("2877"),l=Object(s["a"])(r,a,o,!1,null,null,null);i["a"]=l.exports},cfad:function(t,i,e){"use strict";var a=e("06a4"),o=e.n(a);o.a}}]);